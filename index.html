<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å©šç¤¼è¡Œç¨‹ç™»è®°è¡¨</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ ·å¼åº“) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. å¼•å…¥ Babel (ç”¨äºè§£æ JSX è¯­æ³•) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. å¼•å…¥ LeanCloud SDK -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.0/dist/av-min.js"></script>

    <!-- æ ·å¼å¾®è°ƒ -->
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        /* é’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–ç‚¹å‡»ä½“éªŒ */
        button, input, select, textarea { touch-action: manipulation; }
    </style>
</head>
<body class="bg-rose-50">
    <!-- æŒ‚è½½èŠ‚ç‚¹ -->
    <div id="root"></div>

    <!-- ä½ çš„æ ¸å¿ƒä»£ç  -->
    <script type="text/babel">
        // ========== 1. ä¾èµ–æå– + é…ç½®ï¼ˆå‰ç½®ï¼‰ ==========
        // æ³¨æ„ï¼šåœ¨CDNæ¨¡å¼ä¸‹ï¼ŒReact å’Œ AV å·²ç»æ˜¯å…¨å±€å˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
        const React = window.React;
        const ReactDOM = window.ReactDOM;
        const AV = window.AV; 

        // LeanCloudé…ç½®ï¼ˆå·²å¡«å…¥ä½ æä¾›çš„ä¿¡æ¯ï¼‰
        const CUSTOM_CONFIG = {
          appId: "wedding-2026", 
          leancloud: {
            appId: "TEwiUKqG1NI5UjacEKadSrQF-gzGzoHsz",    
            appKey: "WsUOfPs6EzsIExeUY8pvvOuB",   
            serverURL: "https://tewiukqg.lc-cn-n1-shared.com" 
          },
          adminPwd: "8888"
        };

        // ========== 2. LeanCloudåˆå§‹åŒ–ï¼ˆæ— è¯­æ³•é”™è¯¯ç‰ˆï¼‰ ==========
        let leancloudClient; 
        let initError = null;

        try {
          // æ£€æŸ¥LeanCloud SDKæ˜¯å¦åŠ è½½
          if (!AV || !AV.init) throw new Error("LeanCloud SDKæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥CDN");
          
          // åˆå§‹åŒ–LeanCloud
          AV.init({
            appId: CUSTOM_CONFIG.leancloud.appId,
            appKey: CUSTOM_CONFIG.leancloud.appKey,
            serverURL: CUSTOM_CONFIG.leancloud.serverURL
          });
          leancloudClient = AV; 
          console.log("LeanCloudåˆå§‹åŒ–æˆåŠŸ");
        } catch (e) {
          console.error("LeanCloudåˆå§‹åŒ–å¤±è´¥:", e);
          initError = `LeanCloudåˆå§‹åŒ–å¤±è´¥ï¼š${e.message}`;
        }

        // ========== 3. å·¥å…·å‡½æ•°ï¼ˆEmojiæ›¿ä»£å›¾æ ‡ï¼‰ ==========
        const getTransportIcon = (type) => {
          switch (type) {
            case "é£æœº": return <span>âœˆï¸</span>;
            case "è‡ªé©¾": return <span>ğŸš—</span>;
            case "ç«è½¦": return <span>ğŸš</span>;
            case "å¤§å·´": return <span>ğŸšŒ</span>;
            default: return <span>ğŸš„</span>; // é«˜é“
          }
        };

        // ========== 4. é”™è¯¯è¾¹ç•Œç»„ä»¶ï¼ˆä¿®æ­£æç¤ºæ–‡æ¡ˆï¼‰ ==========
        class ErrorBoundary extends React.Component {
          state = { hasError: false, error: null };
          static getDerivedStateFromError(error) {
            return { hasError: true, error };
          }
          componentDidCatch(error, info) {
            console.error("ç»„ä»¶æ¸²æŸ“é”™è¯¯:", error, info);
          }
          render() {
            if (this.state.hasError) {
              return (
                <div className="min-h-screen flex items-center justify-center p-4">
                  <div className="card max-w-lg w-full bg-white shadow-lg rounded-lg overflow-hidden">
                    <div className="card-header p-4 border-b border-gray-100">
                      <h2 className="text-xl font-bold text-rose-600">é¡µé¢åŠ è½½å¤±è´¥</h2>
                    </div>
                    <div className="card-body p-6">
                      <p className="text-slate-600 mb-4">é”™è¯¯åŸå› ï¼š{this.state.error.message}</p>
                      <p className="text-xs text-slate-500">
                        è¯·æ‰“å¼€æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œæˆ–æ£€æŸ¥LeanCloudé…ç½®
                      </p>
                      <button 
                        onClick={() => window.location.reload()}
                        className="btn bg-rose-500 text-white px-4 py-2 rounded mt-4 hover:bg-rose-600 transition"
                      >
                        åˆ·æ–°é¡µé¢
                      </button>
                    </div>
                  </div>
                </div>
              );
            }
            return this.props.children;
          }
        }

        // ========== 5. æ ¸å¿ƒç»„ä»¶ WeddingFormï¼ˆå…¨é‡æ›¿æ¢ä¸ºLeanCloudï¼‰ ==========
        const WeddingForm = () => {
          // åŸºç¡€çŠ¶æ€
          const [formData, setFormData] = React.useState({
            name: "",
            count: 1,
            arrivalDate: "",
            arrivalTime: "",
            transportType: "é«˜é“",
            location: "",
            phone: "",
            note: ""
          });
          const [successMsg, setSuccessMsg] = React.useState("");
          const [errorMsg, setErrorMsg] = React.useState("");
          const [isAdmin, setIsAdmin] = React.useState(false);
          const [guests, setGuests] = React.useState([]);
          const [loading, setLoading] = React.useState(true);
          const [submitting, setSubmitting] = React.useState(false);
          const [user, setUser] = React.useState(null);
          // ä½¿ç”¨ useRef æ¥å­˜å‚¨ realtimeQueryï¼Œé¿å…å› ä¸ºé—­åŒ…é—®é¢˜å¯¼è‡´ cleanup å¤±è´¥
          const realtimeQueryRef = React.useRef(null);

          // 1. LeanCloudåŒ¿åç™»å½•åˆå§‹åŒ–
          React.useEffect(() => {
            if (initError || !leancloudClient) {
              setLoading(false);
              return;
            }

            // LeanCloudåŒ¿åç™»å½•
            const initAuth = async () => {
              try {
                // åŒ¿åæ³¨å†Œ/ç™»å½•ï¼ˆLeanCloudè‡ªåŠ¨å¤„ç†ï¼‰
                const user = await AV.User.signUpAnonymously();
                setUser({ uid: user.id });
                console.log("åŒ¿åç™»å½•æˆåŠŸï¼Œç”¨æˆ·IDï¼š", user.id);
              } catch (error) {
                console.error("LeanCloudè®¤è¯å¤±è´¥:", error);
                // å±è”½é”™è¯¯æç¤ºï¼Œé¿å…å©šç¤¼é¡µé¢å‡ºç°çº¢è‰²æŠ¥é”™ï¼Œç›´æ¥é™é»˜é™çº§ä¸ºæ¸¸å®¢æ¨¡å¼
                // setErrorMsg(`ç™»å½•å¤±è´¥ï¼š${error.message}ï¼Œå°†ä»¥æ¸¸å®¢æ¨¡å¼å±•ç¤º`);
                setUser({ uid: "guest" });
              } finally {
                setLoading(false);
              }
            };
            initAuth();

            // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
            return () => {
              if (realtimeQueryRef.current) realtimeQueryRef.current.cancel(); 
            };
          }, []);

          // 2. ç®¡ç†å‘˜æ¨¡å¼ - å®æ—¶ç›‘å¬å®¾å®¢æ•°æ®ï¼ˆLeanCloudç‰ˆï¼‰
          React.useEffect(() => {
            if (!isAdmin || !user || !leancloudClient) {
              setGuests([]);
              // å¦‚æœä¸æ˜¯ç®¡ç†å‘˜ï¼Œä¸éœ€è¦è®¾ç½®loadingä¸ºtrueï¼Œé™¤éæ˜¯åœ¨åˆå§‹åŠ è½½
              // è¿™é‡Œæˆ‘ä»¬å‡è®¾åˆå§‹åŠ è½½ç”±ä¸Šé¢çš„ useEffect æ§åˆ¶
              return;
            }

            setLoading(true);
            // å–æ¶ˆä¹‹å‰çš„å®æ—¶ç›‘å¬
            if (realtimeQueryRef.current) realtimeQueryRef.current.cancel();

            try {
              // æ„å»ºæŸ¥è¯¢
              const WeddingGuest = leancloudClient.Object.extend("WeddingGuest");
              const query = new leancloudClient.Query(WeddingGuest);
              query.descending("createdAt"); // æŒ‰åˆ›å»ºæ—¶é—´é™åº

              // é¦–æ¬¡åŠ è½½æ‰€æœ‰æ•°æ®
              query.find().then((results) => {
                const guestsData = results.map(formatGuestData);
                setGuests(guestsData);
                setLoading(false);
                
                // å¼€å¯å®æ—¶ç›‘å¬ (åœ¨ query.find æˆåŠŸåå¼€å¯)
                try {
                    const realtimeQuery = query.subscribe();
                    realtimeQueryRef.current = realtimeQuery;
                    
                    realtimeQuery.on("create", (newGuest) => {
                        setGuests(prev => [formatGuestData(newGuest), ...prev]);
                    });
                    realtimeQuery.on("delete", (deletedGuest) => {
                        setGuests(prev => prev.filter(guest => guest.id !== deletedGuest.id));
                    });
                    realtimeQuery.on("update", (updatedGuest) => {
                        setGuests(prev => prev.map(guest => 
                        guest.id === updatedGuest.id ? formatGuestData(updatedGuest) : guest
                        ));
                    });
                } catch(subError) {
                    console.warn("å®æ—¶ç›‘å¬å¯åŠ¨å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å¼€å‘ç‰ˆé™åˆ¶ï¼‰ï¼š", subError);
                }

              }).catch((error) => {
                console.error("LeanCloudè·å–æ•°æ®å¤±è´¥:", error);
                setErrorMsg(`æ•°æ®åŠ è½½å¤±è´¥ï¼š${error.message}`);
                setLoading(false);
              });
            } catch (error) {
              console.error("LeanCloudæŸ¥è¯¢æ„å»ºå¤±è´¥:", error);
              setErrorMsg(`æŸ¥è¯¢å¤±è´¥ï¼š${error.message}`);
              setLoading(false);
            }

            // ç»„ä»¶å¸è½½æ—¶æ¸…ç†
            return () => {
              if (realtimeQueryRef.current) realtimeQueryRef.current.cancel();
            };
          }, [isAdmin, user]);

          // æ ¼å¼åŒ–LeanCloudæ•°æ®ä¸ºå‰ç«¯å¯ç”¨æ ¼å¼
          const formatGuestData = (guestObj) => {
            return {
              id: guestObj.id,
              name: guestObj.get("name") || "",
              count: guestObj.get("count") || 1,
              arrivalDate: guestObj.get("arrivalDate") || "",
              arrivalTime: guestObj.get("arrivalTime") || "",
              transportType: guestObj.get("transportType") || "é«˜é“",
              location: guestObj.get("location") || "",
              phone: guestObj.get("phone") || "",
              note: guestObj.get("note") || "",
              createdAt: guestObj.get("createdAt") || new Date(),
              userId: guestObj.get("userId") || ""
            };
          };

          // 3. è¾“å…¥å˜æ›´å¤„ç†
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData((prev) => ({ ...prev, [name]: value }));
            if (errorMsg) setErrorMsg("");
          };

          // 4. ç®¡ç†å‘˜ç™»å½•
          const handleAdminLogin = () => {
            if (isAdmin) {
              setIsAdmin(false);
              return;
            }
            const pwd = prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š");
            if (pwd === CUSTOM_CONFIG.adminPwd) {
              setIsAdmin(true);
            } else if (pwd) {
              alert("å¯†ç é”™è¯¯ï¼");
            }
          };

          // 5. æäº¤è¡¨å•ï¼ˆLeanCloudå­˜å‚¨ï¼‰
          const handleSubmit = async (e) => {
            e.preventDefault();
            if (!user || !leancloudClient) {
              setErrorMsg("æ•°æ®æäº¤åŠŸèƒ½æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥LeanCloudé…ç½®");
              return;
            }

            setSubmitting(true);
            setErrorMsg("");
            setSuccessMsg("");

            try {
              // åˆ›å»ºLeanCloudæ•°æ®å¯¹è±¡
              const WeddingGuest = leancloudClient.Object.extend("WeddingGuest");
              const guest = new WeddingGuest();
              
              // è®¾ç½®è¡¨å•æ•°æ®
              guest.set("name", formData.name);
              guest.set("count", parseInt(formData.count));
              guest.set("arrivalDate", formData.arrivalDate);
              guest.set("arrivalTime", formData.arrivalTime);
              guest.set("transportType", formData.transportType);
              guest.set("location", formData.location);
              guest.set("phone", formData.phone);
              guest.set("note", formData.note);
              // createdAt ç”± LeanCloud è‡ªåŠ¨å¤„ç†
              guest.set("userId", user.uid);
              
              // ä¿å­˜åˆ°LeanCloud
              await guest.save();

              // é‡ç½®è¡¨å•
              setSuccessMsg("æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å‚ä¸ï¼ŒæœŸå¾…ä¸æ‚¨ç›¸èšï½");
              setFormData({
                name: "",
                count: 1,
                arrivalDate: "",
                arrivalTime: "",
                transportType: "é«˜é“",
                location: "",
                phone: "",
                note: ""
              });

              // 5ç§’åæ¸…ç©ºæç¤º
              setTimeout(() => setSuccessMsg(""), 5000);
            } catch (error) {
              console.error("LeanCloudæäº¤å¤±è´¥:", error);
              setErrorMsg(`æäº¤å¤±è´¥ï¼š${error.message}ï¼Œè¯·ç¨åé‡è¯•`);
            } finally {
              setSubmitting(false);
            }
          };

          // 6. åˆ é™¤å®¾å®¢æ•°æ®ï¼ˆç®¡ç†å‘˜/LeanCloudç‰ˆï¼‰
          const handleDelete = async (id) => {
            if (!user || !leancloudClient || !window.confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) return;

            try {
              const WeddingGuest = leancloudClient.Object.extend("WeddingGuest");
              // Create a pointer to the existing object
              const guest = WeddingGuest.createWithoutData(id);
              await guest.destroy(); // åˆ é™¤æ•°æ®
              
              // å¦‚æœå®æ—¶ç›‘å¬ç”Ÿæ•ˆï¼Œä¸‹é¢çš„ setGuests å…¶å®å¯ä»¥ä¸å†™ï¼Œä½†ä¸ºäº†ä¿é™©èµ·è§å¯ä»¥æ‰‹åŠ¨è¿‡æ»¤ä¸€ä¸‹
              setGuests(prev => prev.filter(g => g.id !== id));

              setSuccessMsg("åˆ é™¤æˆåŠŸï¼");
              setTimeout(() => setSuccessMsg(""), 3000);
            } catch (error) {
              console.error("LeanCloudåˆ é™¤å¤±è´¥:", error);
              setErrorMsg(`åˆ é™¤å¤±è´¥ï¼š${error.message}`);
            }
          };

          // 7. æ’åºå®¾å®¢æ•°æ®ï¼ˆæŒ‰æ—¥æœŸ+æ—¶é—´ï¼‰
          const sortedGuests = React.useMemo(() => {
            if (!Array.isArray(guests)) return [];
            return [...guests].sort((a, b) => {
              const dateA = a.arrivalDate || "";
              const dateB = b.arrivalDate || "";
              if (dateA !== dateB) return dateA.localeCompare(dateB);
              return (a.arrivalTime || "").localeCompare(b.arrivalTime || "");
            });
          }, [guests]);

          // ========== æ¸²æŸ“é€»è¾‘ï¼ˆä¿®æ­£åˆå§‹åŒ–é”™è¯¯æç¤ºï¼‰ ==========
          if (initError) {
            return (
              <div className="min-h-screen flex items-center justify-center p-4">
                <div className="card max-w-lg w-full bg-white shadow-lg rounded-lg overflow-hidden">
                  <div className="card-header flex items-center gap-2 p-4 border-b border-gray-100">
                    <span>âš ï¸</span>
                    <h2 className="text-xl font-bold text-rose-600">é…ç½®é”™è¯¯</h2>
                  </div>
                  <div className="card-body p-6">
                    <p className="text-slate-600 mb-4">{initError}</p>
                    <div className="bg-slate-50 p-3 rounded-md text-xs text-slate-500 font-mono mb-4">
                      è¯·æ£€æŸ¥ CUSTOM_CONFIG.leancloud ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä»LeanCloudæ§åˆ¶å°å¤åˆ¶ï¼‰
                    </div>
                    <button 
                      onClick={() => window.location.reload()}
                      className="btn bg-rose-500 text-white px-4 py-2 rounded hover:bg-rose-600 transition"
                    >
                      åˆ·æ–°é¡µé¢
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-rose-50 pb-10">
              {/* é¡¶éƒ¨å¯¼èˆª */}
              <header className="sticky top-0 z-10 bg-white shadow-sm border-b border-rose-100">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="bg-rose-600 text-white p-2 rounded-lg">
                      <span>ğŸ‘¤</span>
                    </div>
                    <h1 className="text-xl sm:text-2xl font-bold text-rose-700">å©šç¤¼è¡Œç¨‹ç™»è®°è¡¨</h1>
                  </div>
                  <div className="flex items-center gap-4">
                    <span className="text-sm text-rose-600 hidden md:inline-block">
                      {isAdmin ? "ğŸ‘‘ ç®¡ç†å‘˜æ¨¡å¼" : "â¤ï¸ æ¬¢è¿å¡«å†™"}
                    </span>
                    <button
                      onClick={handleAdminLogin}
                      className="p-2 rounded-full hover:bg-rose-50 transition-colors text-rose-600"
                      title={isAdmin ? "é€€å‡ºç®¡ç†å‘˜" : "è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼"}
                    >
                      {isAdmin ? <span>ğŸ”“</span> : <span>ğŸ”’</span>}
                    </button>
                  </div>
                </div>
              </header>

              {/* ä¸»å†…å®¹åŒº */}
              <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                  {/* è¡¨å•å¡ç‰‡ */}
                  <div className="lg-col-span-1">
                    <div className="bg-white shadow-lg rounded-lg overflow-hidden">
                      <div className="px-6 py-4 border-b border-rose-100 bg-rose-50/50">
                        <h2 className="text-lg font-semibold text-rose-700 flex items-center gap-2">
                          <span>âœ…</span>
                          å¡«å†™è¡Œç¨‹ä¿¡æ¯
                        </h2>
                      </div>
                      <div className="p-6">
                        <form onSubmit={handleSubmit} className="space-y-6">
                          {/* é”™è¯¯æç¤º */}
                          {errorMsg && (
                            <div className="p-3 bg-red-50 text-red-600 rounded-md flex items-center gap-2 text-sm">
                              âŒ {errorMsg}
                            </div>
                          )}

                          {/* æˆåŠŸæç¤º */}
                          {successMsg && (
                            <div className="p-3 bg-green-50 text-green-600 rounded-md flex items-center gap-2 text-sm">
                              âœ… {successMsg}
                            </div>
                          )}

                          {/* å§“å + äººæ•° */}
                          <div className="grid grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <label className="block text-sm font-medium text-slate-700">å§“å *</label>
                              <input
                                required
                                type="text"
                                name="name"
                                value={formData.name}
                                onChange={handleInputChange}
                                placeholder="è¯·è¾“å…¥å§“å"
                                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                              />
                            </div>
                            <div className="space-y-2">
                              <label className="block text-sm font-medium text-slate-700">åŒè¡Œäººæ•° *</label>
                              <input
                                required
                                type="number"
                                min="1"
                                name="count"
                                value={formData.count}
                                onChange={handleInputChange}
                                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                                placeholder="1"
                              />
                            </div>
                          </div>

                          {/* æ—¥æœŸ + æ—¶é—´ */}
                          <div className="grid grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <label className="block text-sm font-medium text-slate-700">åˆ°è¾¾æ—¥æœŸ *</label>
                              <input
                                required
                                type="date"
                                name="arrivalDate"
                                value={formData.arrivalDate}
                                onChange={handleInputChange}
                                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                              />
                            </div>
                            <div className="space-y-2">
                              <label className="block text-sm font-medium text-slate-700">åˆ°è¾¾æ—¶é—´ *</label>
                              <input
                                required
                                type="time"
                                name="arrivalTime"
                                value={formData.arrivalTime}
                                onChange={handleInputChange}
                                className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                              />
                            </div>
                          </div>

                          {/* äº¤é€šæ–¹å¼ */}
                          <div className="space-y-2">
                            <label className="block text-sm font-medium text-slate-700">äº¤é€šæ–¹å¼ *</label>
                            <div className="grid grid-cols-3 gap-2">
                              {["é«˜é“", "é£æœº", "è‡ªé©¾", "ç«è½¦", "å¤§å·´"].map((type) => (
                                <button
                                  key={type}
                                  type="button"
                                  onClick={() => setFormData((prev) => ({ ...prev, transportType: type }))}
                                  className={`px-3 py-2 border rounded-md text-sm transition-colors ${formData.transportType === type ? "bg-rose-50 border-rose-400 text-rose-700" : "border-slate-200 hover:bg-slate-50 text-slate-600"}`}
                                >
                                  {type}
                                </button>
                              ))}
                            </div>
                          </div>

                          {/* åˆ°è¾¾åœ°ç‚¹ */}
                          <div className="space-y-2">
                            <label className="block text-sm font-medium text-slate-700">åˆ°è¾¾ç«™ç‚¹/åœ°ç‚¹ *</label>
                            <div className="relative">
                              <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                <span>ğŸ“</span>
                              </span>
                              <input
                                required
                                type="text"
                                name="location"
                                value={formData.location}
                                onChange={handleInputChange}
                                placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å—ç«™ / é¦–éƒ½æœºåœºT3"
                                className="w-full pl-10 pr-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                              />
                            </div>
                          </div>

                          {/* è”ç³»ç”µè¯ */}
                          <div className="space-y-2">
                            <label className="block text-sm font-medium text-slate-700">è”ç³»ç”µè¯</label>
                            <input
                              type="tel"
                              name="phone"
                              value={formData.phone}
                              onChange={handleInputChange}
                              placeholder="æ–¹ä¾¿æ¥è½¦å¸æœºè”ç³»ï¼ˆé€‰å¡«ï¼‰"
                              className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow"
                            />
                          </div>

                          {/* å¤‡æ³¨ */}
                          <div className="space-y-2">
                            <label className="block text-sm font-medium text-slate-700">å¤‡æ³¨</label>
                            <textarea
                              name="note"
                              value={formData.note}
                              onChange={handleInputChange}
                              rows="2"
                              placeholder="æœ‰è€äºº/å°å­©ï¼Ÿè¡Œæè¾ƒå¤šï¼Ÿï¼ˆé€‰å¡«ï¼‰"
                              className="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-rose-500 transition-shadow resize-none"
                            />
                          </div>

                          {/* æäº¤æŒ‰é’® */}
                          <button
                            type="submit"
                            disabled={submitting || !user}
                            className="w-full bg-rose-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:ring-offset-2 disabled:opacity-70 disabled:cursor-not-allowed transition-all"
                          >
                            {submitting ? (
                              <span className="flex items-center justify-center">
                                <span className="animate-spin mr-2">â³</span>
                                æäº¤ä¸­...
                              </span>
                            ) : (
                              "æäº¤è¡Œç¨‹"
                            )}
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>

                  {/* ç®¡ç†å‘˜æ•°æ®è¡¨æ ¼ */}
                  {isAdmin && (
                    <div className="lg-col-span-2">
                      <div className="bg-white shadow-lg rounded-lg overflow-hidden h-full flex flex-col">
                        <div className="px-6 py-4 border-b border-rose-100 bg-rose-50/50 flex justify-between items-center">
                          <h2 className="text-lg font-semibold text-rose-700 flex items-center gap-2">
                            <span>ğŸ‘¥</span>
                            å®¾å®¢è¡Œç¨‹æ€»è¡¨
                          </h2>
                          <span className="text-sm text-slate-600 bg-white px-3 py-1 rounded-full border border-rose-100">
                             å…± {guests.length} è®°å½• / {guests.reduce((acc, curr) => acc + parseInt(curr.count || 0), 0)} äºº
                          </span>
                        </div>
                        <div className="flex-1 overflow-hidden relative min-h-[400px]">
                          {loading ? (
                            <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-500 bg-white/80 z-10">
                              <span className="animate-spin text-3xl mb-3">â³</span>
                              <p>åŠ è½½æ•°æ®ä¸­...</p>
                            </div>
                          ) : guests.length === 0 ? (
                            <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-500">
                              <span className="text-4xl mb-3 opacity-50">ğŸ‘¥</span>
                              <p>æš‚æ— è¡Œç¨‹è®°å½•ï¼Œå¿«é‚€è¯·å®¾å®¢å¡«å†™å§ï½</p>
                            </div>
                          ) : (
                            <div className="overflow-auto h-full w-full">
                              <table className="min-w-full text-sm text-left">
                                <thead className="bg-rose-50 text-slate-700 sticky top-0 z-10 shadow-sm">
                                  <tr>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">åˆ°è¾¾æ—¶é—´</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">å§“å</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">äººæ•°</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">äº¤é€š</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">åˆ°è¾¾åœ°ç‚¹</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap hidden sm:table-cell">ç”µè¯</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap hidden md:table-cell">å¤‡æ³¨</th>
                                    <th className="px-4 py-3 font-semibold whitespace-nowrap">æ“ä½œ</th>
                                  </tr>
                                </thead>
                                <tbody className="divide-y divide-rose-100">
                                  {sortedGuests.map((guest) => (
                                    <tr key={guest.id} className="hover:bg-rose-50/50 transition-colors">
                                      <td className="px-4 py-3">
                                        <div className="font-medium text-rose-700 whitespace-nowrap">{guest.arrivalDate}</div>
                                        <div className="text-xs text-slate-500 flex items-center gap-1">
                                          <span>ğŸ•’</span>
                                          {guest.arrivalTime}
                                        </div>
                                      </td>
                                      <td className="px-4 py-3 font-medium text-slate-800">{guest.name}</td>
                                      <td className="px-4 py-3 text-slate-600">{guest.count}</td>
                                      <td className="px-4 py-3">
                                        <span className="inline-flex items-center gap-1 px-2 py-1 bg-rose-50 text-rose-700 rounded border border-rose-100 whitespace-nowrap">
                                          {getTransportIcon(guest.transportType)}
                                          {guest.transportType}
                                        </span>
                                      </td>
                                      <td className="px-4 py-3 text-slate-600">{guest.location}</td>
                                      <td className="px-4 py-3 text-slate-600 hidden sm:table-cell">{guest.phone || "-"}</td>
                                      <td className="px-4 py-3 text-slate-600 hidden md:table-cell max-w-[150px] truncate" title={guest.note}>
                                        {guest.note || "-"}
                                      </td>
                                      <td className="px-4 py-3">
                                        <button
                                          onClick={() => handleDelete(guest.id)}
                                          className="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors"
                                          title="åˆ é™¤"
                                        >
                                          <span>ğŸ—‘ï¸</span>
                                        </button>
                                      </td>
                                    </tr>
                                  ))}
                                </tbody>
                              </table>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </main>

              {/* é¡µè„š */}
              <footer className="bg-white border-t border-rose-100 py-6 mt-auto">
                <div className="max-w-7xl mx-auto px-4 text-center text-sm text-slate-400">
                  Â© 2026 å©šç¤¼è¡Œç¨‹ç™»è®° | ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼Œé˜–å®¶å¹¸ç¦ â¤ï¸
                </div>
              </footer>
            </div>
          );
        };

        // ========== 6. æŒ‚è½½ç»„ä»¶ ==========
        const rootElement = document.getElementById("root");
        const root = ReactDOM.createRoot(rootElement);
        root.render(
            <ErrorBoundary>
                <WeddingForm />
            </ErrorBoundary>
        );
    </script>
</body>
</html>
